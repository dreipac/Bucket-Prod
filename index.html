<!doctype html>
<html lang="de" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bucket Liste 8.1.0</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" sizes="512x512" href="icons/logo.png">
</head>
<body>
  <header class="topbar glass">
    <button class="icon-btn pressable" id="menuBtn" aria-label="Men√º">
      <span class="burger"></span>
    </button>
    <h1>Bucket Liste</h1>
    <!-- Rechts: Settings in der Topbar -->
<div class="topbar-actions">
  <!-- ADD: Profil-Anzeige in der Topbar -->
  <div id="profileBadge" class="profile-badge" hidden>
    <img id="profileAvatar" alt="Profilbild">
    <span id="profileText"></span>
  </div>

  <button id="openSettingsTop" class="icon-btn pressable" title="Einstellungen">
    <img id="settings-icon" src="icons/settings.png">
  </button>
</div>

  </header>

  <div class="layout">
    <aside class="sidebar glass" id="sidebar">
    <div class="list-add">
      <button id="addListBtn" class="pill pill-primary pressable" title="Neue Liste erstellen">+ Neue Liste</button>
    </div>



      <nav id="lists" class="lists"></nav>
    </aside>
<div id="sidebarResizer" class="v-splitter" aria-hidden="true"></div>

    <main class="content glass">
      <div class="content-top">
        <button id="addItemBtn" class="btn btn-primary pressable">
          <span class="plus">+</span> Neuer Eintrag
        </button>
         <button id="clearArchiveBtn" class="btn btn-danger pressable" hidden>Archiv leeren</button>

        <!-- Suche & Filter -->
        <div class="filters">
          <input id="searchInput" type="search" placeholder="Suchen (Titel/Notizen) ‚Ä¶" />
        <select id="sortBy" title="Sortierung">
          <option value="none">Sortierung: Aus</option>
          <option value="due">F√§lligkeit</option>
          <option value="status">Status</option>
          <option value="prio">Priorit√§t</option>
          <option value="title">A‚ÄìZ (Titel)</option>
        </select>

          <select id="statusFilter" title="Status">
            <option value="all">Status: Alle</option>
            <option value="open">Nur offen</option>
            <option value="done">Nur erledigt</option>
          </select>
          <select id="dueFilter" title="F√§lligkeit">
            <option value="all">F√§lligkeit: Alle</option>
            <option value="today">Heute</option>
            <option value="overdue">√úberf√§llig</option>
          </select>
          <select id="prioFilter" title="Priorit√§t">
            <option value="all">Priorit√§t: Alle</option>
            <option value="low">Niedrig</option>
            <option value="med">Mittel</option>
            <option value="high">Dringend</option>
          </select>
        </div>
      </div>

      <!-- Fortschritt (bezieht sich auf sichtbare/ gefilterte Eintr√§ge) -->
      <div class="progress-wrap">
        <div class="progress"><div id="progressBar" class="progress-bar"></div></div>
        <div id="progressText" class="progress-text">0 von 0 erledigt (0%)</div>
      </div>

      <ul id="items" class="items"></ul>
      <p id="emptyText" class="empty">Aktuell sind keine Eintr√§ge vorhanden</p>
    </main>
  </div>

  <!-- Drawer (Hamburger ‚Üí von links) -->
  <div id="drawer" class="drawer" aria-hidden="true">
    <div class="drawer-backdrop"></div>
    <aside class="drawer-panel">
      <h3>Men√º</h3>
      <nav class="drawer-nav">
        <button id="openSettings" class="drawer-link pressable">
          <img id="settings-icon" src="icons/settings.png" title="Einstellungen √∂ffnen">
          <span class="btn-drawer-text">Einstellungen</span>
        </button>

        <button id="openProfile" class="drawer-link pressable" title="Profil bearbeiten">
          <img id="settings-icon" src="icons/profil.png">
          <span class="btn-drawer-text">Profil</span>
        </button>

        <!-- Link zum Notizbuch -->
        <button id="openNotebookBtn" class="drawer-link pressable" title="Notizbuch √∂ffnen">
          <img id="settings-icon" src="icons/notebook.png">
          <span class="btn-drawer-text">Notizbuch</span>
        </button>

        <!-- Backup -->
        <button id="backupBtn" class="drawer-link pressable" title="Daten sichern">
          <img id="settings-icon" src="icons/backup.png">
          <span class="btn-drawer-text">Backup sichern</span>
        </button>

        <!-- Restore -->
        <label for="restoreInput" class="drawer-link pressable" title="Daten laden">
          <img id="settings-icon" src="icons/load.png">
          <span class="btn-drawer-text">Backup laden</span>
          <input type="file" id="restoreInput" accept="application/json" hidden>
        </label>

                <!-- beliebiger Button/Link -->
        <button id="logoutAnywhere">Abmelden</button>
        <script>
          document.getElementById("logoutAnywhere")?.addEventListener("click", async ()=>{
            try { await window.sb.auth.signOut(); } catch(_) {}
            location.href = "login.html";
          });
        </script>

      </nav>
    </aside>
  </div>

  <!-- Templates -->
<template id="listButtonTpl">
  <div class="list-row" draggable="false">
    <button class="list-btn pressable" draggable="false">
      <!-- NEU: Icon links vom Titel -->
      <img class="list-ico" alt="" aria-hidden="true" hidden>
      <span class="list-name"></span>
    </button>
    <div class="list-actions">
      <button class="icon xsmall pressable" data-action="rename" title="Umbenennen">‚úé</button>
      <button class="icon xsmall pressable" data-action="delete" title="L√∂schen">üóë</button>
    </div>
    <button class="drag-handle list" title="Ziehen zum Sortieren" aria-label="Ziehen zum Sortieren">‚†ø</button>
  </div>
</template>


  <template id="itemTpl">
    <li class="item card" draggable="false">
      <label class="checkbox">
        <input type="checkbox" />
        <span class="checkmark"></span>
      </label>

      <div class="item-body">
        <div class="row1">
          <span class="title text"></span>
          <span class="prio chip" hidden></span>
          <span class="due chip" hidden></span>
        </div>
        <p class="notes" hidden></p>
        <ul class="subtasks-preview" hidden></ul>
      </div>

      <div class="item-actions">
        <span class="repeat chip" hidden></span>
        <button class="icon small pressable" data-action="edit" title="Bearbeiten">‚úé</button>
        <button class="icon small pressable" data-action="delete" title="L√∂schen">üóë</button>
      </div>

      <button class="drag-handle" title="Zum Sortieren ziehen" aria-label="Ziehen zum Sortieren">‚†ø</button>
    </li>
  </template>

  <!-- Modal: Eintrag -->
  <div id="itemModal" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog glass" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <form id="itemForm" autocomplete="off">
        <h2 id="modalTitle">Neuer Eintrag</h2>

        <label class="field">
          <span class="label">Titel</span>
          <input id="fTitle" type="text" placeholder="Titel‚Ä¶" required />
        </label>

        <section class="settings-section">
          <label class="label">Priorit√§t</label>
          <div id="prioSegment" class="segmented prio-seg">
            <button type="button" class="seg-btn" data-prio="low">Niedrig</button>
            <button type="button" class="seg-btn" data-prio="med">Mittel</button>
            <button type="button" class="seg-btn" data-prio="high">Dringend</button>
          </div>
        </section>

        <div class="row">
          <span class="label">F√§llig bis</span>
          <div class="row-inputs">
            <input id="fDate" type="date" class="chip" />
            <input id="fTime" type="time" class="chip" />
          </div>
        </div>
        <section class="settings-section">
  <label class="label">Wiederholen</label>
  <div class="row repeat-row">
    <select id="fRepeat" class="chip">
      <option value="none">Nicht wiederholen</option>
      <option value="daily">T√§glich</option>
      <option value="weekly">W√∂chentlich</option>
      <option value="monthly">Monatlich</option>
    </select>

    <select id="fRepeatEnd" class="chip">
      <option value="never">Ohne Ende</option>
      <option value="after">Nach Anzahl</option>
      <option value="until">Bis Datum</option>
    </select>

    <input id="fRepeatCount" type="number" class="chip" min="1" step="1" placeholder="Anzahl" style="display:none;">
    <input id="fRepeatUntil" type="date" class="chip" style="display:none;">
  </div>
</section>


        <label class="field">
          <span class="label">Notizen</span>
          <textarea id="fNotes" rows="6" placeholder="Notizen‚Ä¶"></textarea>
        </label>

        <section class="settings-section">
          <label class="label">Unteraufgaben</label>

          <!-- Container f√ºr dynamische Unteraufgaben-Reihen -->
          <div id="subtasksContainer" class="subtasks-list" aria-live="polite"></div>

          <!-- Toolbar: neue Unteraufgabe hinzuf√ºgen -->
          <div class="subtasks-toolbar">
            <button type="button" id="addSubtaskBtn" class="subtask-add-link">
              <span aria-hidden="true">Ôºã</span> Unteraufgabe hinzuf√ºgen
            </button>
          </div>
        </section>


        <div class="modal-actions">
          <button type="button" id="cancelBtn" class="btn btn-muted pressable">Abbrechen</button>
          <button type="button" id="saveItemBtn" class="btn btn-primary pressable">√úbernehmen</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal: Einstellungen -->
  <div id="settingsModal" class="modal" aria-hidden="true">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog glass settings" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <form id="settingsForm" class="settings">

  <!-- Kopfzeile: Back + Header -->
<div class="settings-header row" style="align-items:center; gap:10px;">
  <button type="button" id="settingsBackBtn" class="icon-btn" aria-label="Zur√ºck" hidden>
    <!-- kleiner Chevron links -->
    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
  </button>

  <!-- NEU: Icon links neben dem Titel -->
  <img src="icons/settings.png" alt="" class="modal-title-icon" />

  <h2 id="settingsHeader" style="margin:0;">Einstellungen</h2>
  <div style="margin-left:auto;"></div>
</div>


  <!-- Ebene 1: Men√º -->
  <div id="settingsMenu" class="settings-menu">
    <button type="button" id="openDesign" class="menu-card pressable">
      <div class="menu-card-title">
        <img src="icons/design.png" alt="" class="menu-card-ico" />
        Design
      </div>
      <div class="menu-card-sub">Farbschema, Modus, Hintergrund</div>
    </button>

    <button type="button" id="openMisc" class="menu-card pressable">
      <div class="menu-card-title">
        <img src="icons/sonstiges.png" alt="" class="menu-card-ico" />
        Sonstiges
      </div>
      <div class="menu-card-sub">Layout, Titel &amp; mehr</div>
    </button>

    <button type="button" id="openAccount" class="menu-card pressable">
      <div class="menu-card-title">
        <img src="icons/profil.png" alt="" class="menu-card-ico" />
        Konto
      </div>
      <div class="menu-card-sub">Profilbild, Name, Organisation</div>
    </button>

    <button type="button" id="openVersion" class="menu-card pressable">
      <div class="menu-card-title">
        <img src="icons/info.png" alt="" class="menu-card-ico" />
        Version
      </div>
      <div class="menu-card-sub">Versionierung</div>
    </button>
  </div>

  <!-- Ebene 2: DESIGN (nur Farbschema, Modus, Hintergrund) -->
  <div id="settingsDesign" hidden>
    <!-- Farbschema -->
    <div class="settings-section">
      <h3>Farbschema</h3>
      <div id="themeGrid" class="theme-grid">
        <!-- deine Swatches bleiben dynamisch wie zuvor; Container-ID beibehalten -->
      </div>
    </div>

    <!-- Modus -->
    <div class="settings-section">
      <h3>Darstellung</h3>
      <div id="modeSegment" class="segmented">
        <button type="button" class="seg-btn" data-mode="light" aria-pressed="false">Hell</button>
        <button type="button" class="seg-btn" data-mode="dark" aria-pressed="false">Dunkel</button>
        <button type="button" class="seg-btn" data-mode="galaxy" aria-pressed="false">Galaxy</button>
      </div>
    </div>

    <!-- Hintergrund -->
    <div class="settings-section">
      <h3>Hintergrund</h3>
      <select id="bgSelect" class="select-modern">
        <option value="zurich">Z√ºrich</option>
        <option value="geneva">Genf</option>
        <option value="zug">Zug</option>
        <option value="prizren">Prizren</option>
        <option value="chur">Chur</option>
        <option value="luzern">Luzern</option>
        <option value="lugano">Lugano</option>
      </select>
    </div>
  </div>

  <!-- NEU: Version-Ansicht -->
<section id="settingsVersion" class="settings-section" hidden style="display:none;">
  <div class="version-view glass">
    <img src="icons/logo.png" alt="App Logo" class="version-logo" />
    <h2 class="version-title">
      <span id="aboutAppTitle">Bucket Liste</span>
    </h2>
    <p class="version-string">Version 8.1.0</p>
  </div>
</section>

  <!-- Ebene 2: SONSTIGES (alle restlichen Einstellungen) -->
  <div id="settingsMisc" hidden>
    <!-- Glas-Opazit√§t -->
    <div class="settings-section field">
      <label class="label">Glas-Intensit√§t</label>
      <div class="range-row">
        <input id="opacityRange" type="range" min="0.3" max="0.95" step="0.01">
        <div id="opacityValue" class="range-value">0.75</div>
      </div>
    </div>

    <!-- Karten-Opazit√§t -->
    <div class="settings-section field">
      <label class="label">Karten-Opazit√§t</label>
      <div class="range-row">
        <input id="cardOpacityRange" type="range" min="0.3" max="0.98" step="0.01">
        <div id="cardOpacityValue" class="range-value">0.82</div>
      </div>
    </div>

    <!-- Kartenskalierung -->
    <div class="settings-section field">
      <label class="label">Kartenskalierung</label>
      <div class="range-row">
        <input id="cardScaleRange" type="range" min="0.85" max="1.35" step="0.01">
        <div id="cardScaleValue" class="range-value">1.00</div>
      </div>
    </div>

    <!-- Sidebar-Breite -->
    <div class="settings-section field">
      <label class="label">Sidebar-Breite</label>
      <div class="range-row">
        <input id="sideWidthRange" type="range" min="220" max="520" step="2">
        <div id="sideWidthValue" class="range-value">280px</div>
      </div>
    </div>

    <!-- Button-Press-Speed -->
    <div class="settings-section field">
      <label class="label">Button-Press-Speed</label>
      <div class="range-row">
        <input id="pressSpeedRange" type="range" min="0.5" max="2.0" step="0.01">
        <div id="pressSpeedValue" class="range-value">1.00√ó</div>
      </div>
    </div>

        <!-- Neue Liste erstellen: Sofort vs. Mit Modal -->
    <div class="settings-section">
      <h3>Neue Liste erstellen</h3>
      <div id="listCreateModeSegment" class="segmented">
        <button type="button" class="seg-btn" data-create="instant" aria-pressed="false">Sofort</button>
        <button type="button" class="seg-btn" data-create="modal" aria-pressed="false">Mit Modal</button>
      </div>
    </div>

    <!-- Notizbuch √∂ffnen: Gleicher Tab vs. Neuer Tab -->
    <div class="settings-section">
      <h3>Notizbuch √∂ffnen</h3>
      <div id="notebookOpenModeSegment" class="segmented">
        <button type="button" class="seg-btn" data-nb="same" aria-pressed="false">Gleicher Tab</button>
        <button type="button" class="seg-btn" data-nb="new" aria-pressed="false">Neuer Tab</button>
      </div>
    </div>

    <!-- App-Titel -->
<div class="settings-section field">
  <div class="ff">
    <input id="appTitleInput" type="text" placeholder=" " required />
    <label for="appTitleInput">App-Titel</label>
  </div>
</div>


  <!-- Modal-Aktionen (Schlie√üen bleibt) -->
  <div class="modal-actions">
    <button id="settingsCancel" class="btn btn-muted" type="button">Schlie√üen</button>
  </div>
</form>
  </div>
</div>
</div>

  <!-- Modal: Archiv leeren -->
<div id="clearArchiveModal" class="modal" aria-hidden="true">
  <div class="modal-backdrop"></div>
  <div class="modal-dialog glass" role="dialog" aria-modal="true" aria-labelledby="clearArchiveTitle">
    <div class="modal-content">
      <h2 id="clearArchiveTitle">Archiv leeren?</h2>
      <p>Alle archivierten Eintr√§ge werden dauerhaft entfernt. Bist du sicher?</p>
      <div class="modal-actions">
        <button type="button" id="clearArchiveCancel" class="btn btn-muted pressable">Abbrechen</button>
        <button type="button" id="clearArchiveConfirm" class="btn btn-danger pressable">Archiv leeren</button>
      </div>
    </div>
  </div>
</div>

<!-- NEU: Modal - Neue Liste erstellen -->
<div id="listCreateModal" class="modal" aria-hidden="true">
  <div class="modal-backdrop"></div>
  <div class="modal-dialog glass" role="dialog" aria-modal="true" aria-labelledby="listCreateTitle">
    <form id="listCreateForm" autocomplete="off">
      <h2 id="listCreateTitle">Neue Liste</h2>

      <div class="ff">
        <input id="listCreateName" type="text" placeholder=" " required />
        <label for="listCreateName">Listenname</label>
      </div>

<section class="settings-section">
  <label class="label">Icon ausw√§hlen</label>
  <div id="listIconGrid" class="icon-grid">
    <!-- 5 kleine Kacheln ‚Äì existierende Dateien im Ordner /icons -->
    <button type="button" class="icon-tile" data-icon="icons/aufgaben.png" aria-pressed="false">
      <img src="icons/aufgaben.png" alt="Bucket">
    </button>
    <button type="button" class="icon-tile" data-icon="icons/compliance.png" aria-pressed="false">
      <img src="icons/compliance.png" alt="Zahnrad">
    </button>
    <button type="button" class="icon-tile" data-icon="icons/pending.png" aria-pressed="false">
      <img src="icons/pending.png" alt="Notizbuch">
    </button>
    <button type="button" class="icon-tile" data-icon="icons/dauer.png" aria-pressed="false">
      <img src="icons/dauer.png" alt="Backup">
    </button>
    <button type="button" class="icon-tile" data-icon="icons/note.png" aria-pressed="false">
      <img src="icons/note.png" alt="Laden">
    </button>
  </div>
  <p class="hint">Optional ‚Äì wenn du nichts ausw√§hlst, wird die Liste ohne Icon erstellt.</p>
</section>
      <div class="modal-actions">
        <button type="button" id="listCreateCancel" class="btn btn-muted pressable">Abbrechen</button>
        <button type="submit" id="listCreateCreateBtn" class="btn btn-primary pressable">Erstellen</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Profil -->
<div id="profileModal" class="modal" aria-hidden="true">
  <div class="modal-backdrop"></div>
  <div class="modal-dialog glass" role="dialog" aria-modal="true" aria-labelledby="profileTitle">
    <form id="profileForm" autocomplete="off">
      <div class="modal-title-with-icon">
        <img src="icons/profil.png" alt="" class="modal-title-icon" />
        <h2 id="profileTitle">Profil anlegen</h2>
      </div>


      <div class="row" style="align-items:center;">
        <img id="profilePreview" class="avatar-preview" alt="Vorschau" />
        <label class="field" style="flex:1;">
          <span class="label">Profilbild</span>
          <input id="profileImageInput" type="file" accept="image/*">
        </label>
      </div>

      <div class="row">
        <label class="field" style="flex:1;">
          <span class="label">Vorname</span>
          <div class="ff">
            <input id="profileFirst" type="text" placeholder=" " autocomplete="given-name" />
            <label for="profileFirst">Vorname</label>
          </div>
        </label>
        <label class="field" style="flex:1;">
          <span class="label">Nachname</span>
          <div class="ff">
            <input id="profileLast" type="text" placeholder=" " autocomplete="family-name" />
            <label for="profileLast">Nachname</label>
          </div>
        </label>
      </div>

      <label class="field">
        <span class="label">Organisation</span>
        <div class="ff">
          <input id="profileOrg" type="text" placeholder=" " autocomplete="organization" />
          <label for="profileOrg">Organisation</label>
        </div>
      </label>

      <div class="modal-actions">
        <button type="button" id="profileCancel" class="btn btn-muted pressable">Sp√§ter</button>
        <button type="submit" id="profileSave" class="btn btn-primary pressable">Speichern</button>
      </div>
    </form>
  </div>
</div>


<!-- Galaxy starfield canvas (nur im Modus 'galaxy' sichtbar) -->
<canvas id="galaxyCanvas" aria-hidden="true"></canvas>

  <!-- Toasts root (oben rechts) -->
<div id="toast-root" aria-live="polite" aria-atomic="true"></div>

<!-- Supabase zuerst laden -->
<script type="module" src="supabase.js"></script>

<!-- Auf Supabase warten, Session pr√ºfen, DANN app.js laden -->
<script>
  window.addEventListener("sb-ready", async () => {
    const { data: { session } } = await window.sb.auth.getSession();

    if (!session?.user) {
      // nicht eingeloggt -> zur√ºck zur Login-Seite
      location.href = "login.html";
      return;
    }

    // Session global setzen (falls app.js darauf schaut)
    window.__SB_USER__ = session.user;

    // Jetzt erst die App laden (als Modul!)
    const s = document.createElement("script");
    s.type = "module";
    s.src = "app.js";
    document.body.appendChild(s);
  });
</script>


</body>
</html>
